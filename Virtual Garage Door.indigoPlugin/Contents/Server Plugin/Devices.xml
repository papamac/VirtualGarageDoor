<?xml version="1.0"?>
<!--
 PACKAGE:  Virtual Garage Door - Monitoring and control of conventional garage
           door openers for Indigo
  MODULE:  Devices.xml
   TITLE:  Define and initialize PiDACS-Bridge device objects (Devices.xml)
FUNCTION:  Devices.xml defines the structure of the PiDACS-Bridge device
           objects, specifies GUI labels, and sets default values.
   USAGE:  Devices.xml is read by the indigo server during plugin startup.
  AUTHOR:  papamac
 VERSION:  0.8
    DATE:  May 31, 2022


CHANGE LOG:

v0.5.0  12/27/2020  Initial beta version.
v0.6.0   2/16/2021  Add fields to name the on/off sensor/actuator states
                    defaulting with the usual "onOffState".  This allows the
                    use of EasyDAQ digital input/output/relay devices that
                    include the channel number in the state name, e.g.,
                    "channel01".
v0.7.0    9/9/2021  Change opener device type to relay for compatibility with
                    the HomeKit Bridge plugin.  Eliminate the numeric door
                    state and change it to a descriptive door status.
v0.9.0   5/31/2022  Add a new monitored device called activationSensor that
                    turns on when the garage door opener is activated.  Keep
                    the openerRelay (formally actuatorRelay) only for use in
                    controlling the door.  Add a field to specify the relay
                    channel number for EasyDAQ relays.
-->

<Devices>

    <!-- ############### Virtual Garage Door Opener Device ################ -->

    <Device id="opener" type="relay">
        <Name>Virtual Garage Door Opener</Name>
        <ConfigUI>

            <!-- ################ Garage Door Travel Time ################# -->

            <Field id="timerTitle" type="label" alignText="center">
                <Label>Garage Door Travel Time</Label>
            </Field>

            <Field id="timerSpacer" type="label">
                <Label> </Label>
            </Field>

            <Field id="travelTime" type="textfield" defaultValue="12">
                <Label>Open/Close Travel Time (sec):</Label>
            </Field>

            <Field id="travelTimeLabel" type="label" fontSize="small" fontColor="darkgray" alignWithControl="true">
                <Label>Specify the door's maximum open/close travel time in seconds.</Label>
            </Field>

            <!-- ################## Sensor Devices Header ################# -->

            <Field id="sensorSeparator" type="separator"> </Field>

            <Field id="sensorTitle" type="label" alignText="center">
                <Label>Garage Door Sensor Devices (select at least one)</Label>
            </Field>

            <!-- ##################### Closed Sensor ###################### -->

            <Field id="closedSensorSpacer" type="label">
                <Label> </Label>
            </Field>

            <Field id="closedSensor" type="menu">
                <Label>Closed Sensor:</Label>
                <List class="self" method="getSensorDeviceList"
                      dynamicReload="yes"/>
            </Field>

            <Field id="closedSensorStateName" type="textfield"
                   defaultValue="onOffState">
                <Label>on/off State Name:</Label>
            </Field>

            <Field id="invertClosedSensorState" type="checkbox" defaultValue="false">
                <Label>Invert on/off State:</Label>
            </Field>

            <Field id="closedSensorLabel" type="label" fontSize="small" fontColor="darkgray" alignWithControl="true">
                <Label>Optionally select/enter an on/off sensor and state name that indicates the door's closed state.  Check "Invert" if the sensor is "off" when the door is fully closed; uncheck it if not.  For EasyDAQ devices, the on/off state name is the channel number "channelnn" (nn = 01-24).</Label>
            </Field>

            <!-- ###################### Open Sensor ####################### -->

            <Field id="openSensorSpacer" type="label">
                <Label> </Label>
            </Field>

            <Field id="openSensor" type="menu">
                <Label>Open Sensor:</Label>
                <List class="self" method="getSensorDeviceList"
                      dynamicReload="yes"/>
            </Field>

            <Field id="openSensorStateName" type="textfield"
                   defaultValue="onOffState">
                <Label>on/off State Name:</Label>
            </Field>

            <Field id="invertOpenSensorState" type="checkbox"
                   defaultValue="false">
                <Label>Invert on/off State:</Label>
            </Field>

            <Field id="openSensorLabel" type="label" fontSize="small" fontColor="darkgray" alignWithControl="true">
                <Label>Optionally select/enter an on/off sensor and state name that indicates the door's open state.  Check "Invert" if the sensor is "off" when the door is fully open; uncheck it if not.  For EasyDAQ devices, the on/off state name is the channel number "channelnn" (nn = 01-24).</Label>
            </Field>

             <!-- ################### Activation Sensor ################### -->

            <Field id="activationSensorSpacer" type="label">
                <Label> </Label>
            </Field>

            <Field id="activationSensor" type="menu">
                <Label>Activation Sensor:</Label>
                <List class="self" method="getSensorDeviceList"
                      dynamicReload="yes"/>
            </Field>

            <Field id="activationSensorStateName" type="textfield"
                   defaultValue="onOffState">
                <Label>on/off State Name:</Label>
            </Field>

            <Field id="invertActivationSensorState" type="checkbox"
                   defaultValue="false">
                <Label>Invert on/off State:</Label>
            </Field>

            <Field id="activationSensorLabel" type="label" fontSize="small" fontColor="darkgray" alignWithControl="true">
                <Label>Optionally select/enter an on/off sensor and state name that captures an opener activation event.  Check "Invert" if the sensor is "off" when the door opener is activated; uncheck it if not.  The activation sensor may be the same device as the opener relay for activations performed by relay action.  For EasyDAQ devices, the on/off state name is the channel number "channelnn" (nn = 01-24).</Label>
            </Field>

            <!-- ###################### Opener Relay ###################### -->

            <Field id="relaySeparator" type="separator"> </Field>

            <Field id="relayTitle" type="label" alignText="center">
                <Label>Garage Door Opener Relay Device</Label>
            </Field>

            <Field id="relaySpacer" type="label">
                <Label> </Label>
            </Field>

            <Field id="openerRelay" type="menu">
                <Label>Opener Relay</Label>
                <List class="self" method="getRelayDeviceList"
                      dynamicReload="yes"/>
            </Field>

            <Field id="easyDAQRelayChannel" type="textfield"
                   defaultValue="None">
                <Label>EasyDAQ Relay Channel (1-16):</Label>
            </Field>

            <Field id="relayLabel" type="label" fontSize="small" fontColor="darkgray" alignWithControl="true">
                <Label>Optionally select a momentary contact relay that activates the garage door opener.  For an EasyDAQ relay, provide the relay channel number.</Label>
            </Field>

        </ConfigUI>

        <!-- ########################## States ############################ -->

        <States>

            <State id="state">
                <ValueType>
                    <List>
                        <Option value="closed">Closed</Option>
                        <Option value="opening">Opening</Option>
                        <Option value="open">Open</Option>
                        <Option value="closing">Closing</Option>
                        <Option value="stopped">Stopped</Option>
                        <Option value="reversing">Reversing</Option>
                    </List>
                </ValueType>
                <TriggerLabel>Door State</TriggerLabel>
                <TriggerLabelPrefix>Door State</TriggerLabelPrefix>
                <ControlPageLabel>Door State</ControlPageLabel>
                <ControlPageLabelPrefix>Door State</ControlPageLabelPrefix>
            </State>

        </States>
    </Device>
</Devices>
